Data Currency Model More on CERTAINTY(q)  Towards a Foundation of Data Currency Jef Wijsen University of Mons Joint work with Wenfei Fan and Floris Geerts, University of Edinburgh  TIME Symposium, 2011  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Background/Motivation  "The problem with data is that its quality quickly degenerates over time.
Experts say 2 percent of records in a customer file become obsolete in one month because customers die, divorce, marry, and move."
[Eck02] Often no reliable timestamps.
How can we decide the "current truth" of a Boolean query?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Outline  1  Data Currency Model Basic Model Extension: Currency Constraints Extension: Copying  2  More on CERTAINTY(q) Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Caveat  Simplified version of the currency model proposed at PODS 2011 [FGW11].
But the simplification maintains lower and upper complexity bounds of the problems presented.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Outline  1  Data Currency Model Basic Model Extension: Currency Constraints Extension: Copying  2  More on CERTAINTY(q) Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Ordered Relation Ordered relation (I , [?])
Relation I equipped with a currency order [?]
such that: distinct tuples that agree on the primary key are comparable under [?
]; and tuples that disagree on the primary key are incomparable.
Example EMP t1 : t2 : t3 :  FN Mary Mary Mary  LN Smith Smith Smith  Addr 2 Small St 10 Elm Ave 6 Main St  Sal 50k 80k 50k  Stat single married married  t4 : t5 :  Bob Bob  Luth Luth  8 Cowan St 8 Drum St  55k 80k  married married  Jef Wijsen  Data Currency  t1 [?]
t3 [?]
t2 t4 [?]
t5  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Ordered Relation Ordered relation (I , [?])
Relation I equipped with a currency order [?]
such that: distinct tuples that agree on the primary key are comparable under [?
]; and tuples that disagree on the primary key are incomparable.
Example EMP t1 : t2 : t3 :  FN Mary Mary Mary  LN Smith Smith Smith  Addr 2 Small St 10 Elm Ave 6 Main St  Sal 50k 80k 50k  Stat single married married  t4 : t5 :  Bob Bob  Luth Luth  8 Cowan St 8 Drum St  55k 80k  married married  Jef Wijsen  Data Currency  t1 [?]
t3 [?]
t2 t4 [?]
t5  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Ordered Relation Ordered relation (I , [?])
Relation I equipped with a currency order [?]
such that: distinct tuples that agree on the primary key are comparable under [?
]; and tuples that disagree on the primary key are incomparable.
Example EMP t1 : t2 : t3 :  FN Mary Mary Mary  LN Smith Smith Smith  Addr 2 Small St 10 Elm Ave 6 Main St  Sal 50k 80k 50k  Stat single married married  t4 : t5 :  Bob Bob  Luth Luth  8 Cowan St 8 Drum St  55k 80k  married married  Jef Wijsen  Data Currency  t1 [?]
t3 [?]
t2 t4 [?]
t5  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Ordered Relation Ordered relation (I , [?])
Relation I equipped with a currency order [?]
such that: distinct tuples that agree on the primary key are comparable under [?
]; and tuples that disagree on the primary key are incomparable.
Example EMP t1 : t2 : t3 :  FN Mary Mary Mary  LN Smith Smith Smith  Addr 2 Small St 10 Elm Ave 6 Main St  Sal 50k 80k 50k  Stat single married married  t4 : t5 :  Bob Bob  Luth Luth  8 Cowan St 8 Drum St  55k 80k  married married  There is a unique present.
Jef Wijsen  Data Currency  t1 [?]
t3 [?]
t2 t4 [?]
t5  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Present  Present [relation] Relation obtained by selecting all greatest tuples.
Example EMP  FN Mary Bob  LN Smith Luth  Addr 10 Elm Ave 8 Drum St  Jef Wijsen  Sal 80k 80k  Stat married married  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Unordered Relation Unordered relation A relation in which primary keys need not be satisfied.
No currency order.
Example EMP t1 : t2 : t3 :  FN Mary Mary Mary  LN Smith Smith Smith  Addr 2 Small St 10 Elm Ave 6 Main St  Sal 50k 80k 50k  Stat single married married  t4 : t5 :  Bob Bob  Luth Luth  8 Cowan St 8 Drum St  55k 80k  married married  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Unordered Relation Unordered relation A relation in which primary keys need not be satisfied.
No currency order.
Example EMP t1 : t2 : t3 :  FN Mary Mary Mary  LN Smith Smith Smith  Addr 2 Small St 10 Elm Ave 6 Main St  Sal 50k 80k 50k  Stat single married married  t4 : t5 :  Bob Bob  Luth Luth  8 Cowan St 8 Drum St  55k 80k  married married  This leaves six possible presents.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  [Currently] Certain Completion (of an unordered relation) Ordered relation obtained by adding a currency order [?]
to an unordered relation.
Every completion gives a possible present.
Definition A Boolean query is [currently] certain if it is true in each possible present.
Certainty It is certain that "Bob is married."
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Certainty The problem of certainty For any fixed Boolean first-order query q, CERTAINTY(q) is the following problem: Input An unordered relation Question Is q [currently] certain?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Certainty The problem of certainty For any fixed Boolean first-order query q, CERTAINTY(q) is the following problem: Input An unordered relation Question Is q [currently] certain?
Data complexity CERTAINTY(q) is in coNP.
There exists a Boolean conjunctive query q such that CERTAINTY(q) is coNP-complete.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Outline  1  Data Currency Model Basic Model Extension: Currency Constraints Extension: Copying  2  More on CERTAINTY(q) Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Currency Constraints Definition Currency constraints are denial constraints that restrict the set of legal completions (and hence restrict the set of possible presents).
Currency constraints Salaries don't decrease.
![?]s[?
]t s.FN = t.FN [?]
s.LN = t.LN[?]
s.Sal < t.Sal [?]
t [?]
s Mary never divorced.
![?]s[?
]t s.FN = t.FN = Mary [?]
s.LN = t.LN = Smith[?]
 s.Stat = single [?]
t.Stat = married [?]
t [?]
s Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Consistent Consistency w.r.t.
a set S of denials We call an unordered relation I consistent if it has a consistent completion (i.e., if (I , [?])
|= S for some currency order [?]
on I ).
Inconsistency EMP s1 : s2 :  FN Mary Mary  LN Smith Smith  Addr 2 Small St 10 Elm Ave  Sal 80k 50k  Stat single married  ![?]s[?
]t s.FN = t.FN [?]
s.LN = t.LN[?]
s.Sal < t.Sal [?]
t [?]
s ![?]s[?
]t s.FN = t.FN = Mary [?]
s.LN = t.LN = Smith[?]
 s.Stat = single [?]
t.Stat = married [?]
t [?]
s Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Consistency The problem of consistency For any fixed set S of currency constraints, CONSISTENCY(S) is the following problem: Input An unordered relation I Question Is I consistent?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Consistency The problem of consistency For any fixed set S of currency constraints, CONSISTENCY(S) is the following problem: Input An unordered relation I Question Is I consistent?
Data complexity CONSISTENCY(S) is in NP.
There exists a set S of currency constraints such that CONSISTENCY(S) is NP-complete.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Outline  1  Data Currency Model Basic Model Extension: Currency Constraints Extension: Copying  2  More on CERTAINTY(q) Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Background/Motivation  Deciding the "current truth" (of a Boolean query) in: Data integration: Conflicting facts are provided by a large number of sources [DBES09].
Data replication: Applications use out-of-date replicas to improve scalability, availability, and performance [GLR05].
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Copying Example CACHE s1 : s2 : EMP t1 : t2 :  FN Mary Mary FN Mary Mary  LN Smith Smith LN Smith Smith  Addr 2 Small St 10 Elm Ave  Sal 50k 70k  Stat single married  Addr 2 Small St 6 Main St  Sal 60k 60k  Stat single married  The cache is a finite set of unordered tuples.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Copying Example CACHE s1 : s2 : EMP t1 : t2 :  FN Mary Mary FN Mary Mary  LN Smith Smith LN Smith Smith  Addr 2 Small St 10 Elm Ave  Sal 50k 70k  Stat single married  Addr 2 Small St 6 Main St  Sal 60k 60k  Stat single married  The cache is a finite set of unordered tuples.
Should we extend EMP with extra tuples from the cache in order to get the "current truth" of a Boolean query?
Compare:  "Is Mary married?"
"Does Mary earn 60k?"
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Copying Problems Caveat Extending with all "cache" tuples may result in inconsistency.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Copying Problems Caveat Extending with all "cache" tuples may result in inconsistency.
Consistent extension w.r.t.
a set S of denials An unordered relation can be extended with "cache" tuples.
We call such extension maximal consistent if it is consistent; and any further proper extension is inconsistent.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Copying Problems Caveat Extending with all "cache" tuples may result in inconsistency.
Consistent extension w.r.t.
a set S of denials An unordered relation can be extended with "cache" tuples.
We call such extension maximal consistent if it is consistent; and any further proper extension is inconsistent.
Don't confuse: Completion Extension  adding currency order [?]
importing "cache" tuples Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Certainty Preservation The problem of certainty preservation For any fixed Boolean first-order query q and set S of currency constraints, CPP(q, S) is the following problem: Input  a consistent unordered relation in which q is [currently] certain a "cache"  Question Is q [currently] certain in at least one maximal consistent extension?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Certainty Preservation The problem of certainty preservation For any fixed Boolean first-order query q and set S of currency constraints, CPP(q, S) is the following problem: Input  a consistent unordered relation in which q is [currently] certain a "cache"  Question Is q [currently] certain in at least one maximal consistent extension?
Data complexity CPP(q, S) is in Sp2 .
There exists a Boolean conjunctive query q and set S such that CPP(q, S) is Sp2 -complete.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Basic Model Extension: Currency Constraints Extension: Copying  Sp2 Algorithm  Outline 1 Guess an ordered relation (I , [?]).
2  Verify I is an extension and (I , [?])
|= S (in P).
3  Verify maximality, i.e., adding an extra cache tuple to I results in inconsistency (at most linearly many queries of coNP oracle).
4  Verify q is [currently] certain in I (one query of coNP oracle).
Hardness is by reduction from the complement of [?][?
]3CNF .
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Outline  1  Data Currency Model Basic Model Extension: Currency Constraints Extension: Copying  2  More on CERTAINTY(q) Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Back to the Basic Model/Motivation  No currency constraints.
No copying.
What you get if you strip off timestamps from a temporal relation.
We have seen that even in this basic model, there exists a Boolean conjunctive query q such that CERTAINTY(q) is coNP-hard.
Can we identify queries q for which CERTAINTY(q) is tractable (or, even better, first-order definable)?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Unordered Database Again Unordered database A database in which primary keys need not be satisfied.
Possible present In the absence of currency constraints, a possible present is any maximal subset of tuples that satisfy primary keys.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Unordered Database Again Unordered database A database in which primary keys need not be satisfied.
Possible present In the absence of currency constraints, a possible present is any maximal subset of tuples that satisfy primary keys.
Every tuple was once true T R  FN Mary Mary  LN Smith Smith  Dname R&D MIS  Dname R&D MIS Toys Toys  2 x 2 possible presents Jef Wijsen  Data Currency  Budget 60K 60K 60K 70K  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Certainty Definition A Boolean query is certain if it is true in each possible present.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Certainty Definition A Boolean query is certain if it is true in each possible present.
Example T R  FN Mary Mary  LN Smith Smith  Dname R&D MIS  Dname R&D MIS Toys Toys  Budget 60K 60K 60K 70K  q1 = [?
]x(R(Mary, x, R&D)) q2 = [?]x[?
]y (R(Mary, x, y ) [?]
T (y , 60K)) q1 is not certain, q2 is certain Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Problem Statement CERTAINTY(q) For fixed Boolean query q, the problem CERTAINTY(q) is: Given an unordered database, is q certain?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Problem Statement CERTAINTY(q) For fixed Boolean query q, the problem CERTAINTY(q) is: Given an unordered database, is q certain?
Complexity for conjunctive queries For q3 = [?]x[?
]y [?
]z(S(x, z) [?]
T (y , z)), CERTAINTY(q3 ) is coNP-hard.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Problem Statement CERTAINTY(q) For fixed Boolean query q, the problem CERTAINTY(q) is: Given an unordered database, is q certain?
Complexity for conjunctive queries For q3 = [?]x[?
]y [?
]z(S(x, z) [?]
T (y , z)), CERTAINTY(q3 ) is coNP-hard.
CERTAINTY(q1 ) is first-order expressible (see later).
That is, "Is q1 certain?"
can be encoded in FO.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Problem Statement CERTAINTY(q) For fixed Boolean query q, the problem CERTAINTY(q) is: Given an unordered database, is q certain?
Complexity for conjunctive queries For q3 = [?]x[?
]y [?
]z(S(x, z) [?]
T (y , z)), CERTAINTY(q3 ) is coNP-hard.
CERTAINTY(q1 ) is first-order expressible (see later).
That is, "Is q1 certain?"
can be encoded in FO.
Research problem Find algorithm for the following decision problem: Given Boolean conjunctive query q, is CERTAINTY(q) first-order expressible (and hence in AC0 )?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  State of the art [Wij10a] An algorithm for the following decision problem: Given Boolean acyclic conjunctive query q without self-join, is CERTAINTY(q) first-order expressible?
If answer is "yes," we can construct the first-order expression.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  State of the art [Wij10a] An algorithm for the following decision problem: Given Boolean acyclic conjunctive query q without self-join, is CERTAINTY(q) first-order expressible?
If answer is "yes," we can construct the first-order expression.
Remaining restrictions q without self-join == no duplicate relation names in q q acyclic == q has a join tree  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Join Tree Definition A join tree for conjunctive query q is an undirected tree whose vertices are the atoms of q, such that: Connectedness Cond.
if the same variable x occurs in two distinct atoms F and G , then x occurs in each vertex on the (unique) path linking F and G .
Jef Wijsen  Example R0 (x, y ) {x, y }  {x}  R1 (y , x) {x, y } R2 (x, y ) R3 (x, z)  {x, z} R4 (x, z)  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Outline  1  Data Currency Model Basic Model Extension: Currency Constraints Extension: Copying  2  More on CERTAINTY(q) Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  First-order Expressibility  CERTAINTY(q1 ) is first-order expressible q1 = [?
]x(R(Mary, x, R&D))  ph1 = [?
]x R(Mary, x, R&D)[?]
 [?
]z R(Mary, x, z) - z = R&D For every unordered database, q1 certain == ph1 true.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  First-order Expressibility CERTAINTY(q2 ) is first-order expressible q2 = [?]x[?
]y (R(Mary, x, y ) [?]
T (y , 60K)) h ph2 = [?]x[?
]y R(Mary, x, y )[?]
  [?
]y R(Mary, x, y ) - T (y , 60K)[?]
i [?
]z T (y , z) - z = 60K  For every unordered database, q2 certain == ph2 true.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Order is Important Changing the order q2 = [?]x[?
]y (T (y , 60K) [?]
R(Mary, x, y )) h ' ph2 = [?
]y T (y , 60K)[?]
 [?
]z T (y , z) - z = 60K[?]
 [?
]x R(Mary, x, y )[?]
[?
]w R(Mary, x, w ) - w = y  i  For every unordered database, ph'2 true == q2 certain; but the converse does not hold:  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Order is Important Changing the order q2 = [?]x[?
]y (T (y , 60K) [?]
R(Mary, x, y )) h ' ph2 = [?
]y T (y , 60K)[?]
 [?
]z T (y , z) - z = 60K[?]
 [?
]x R(Mary, x, y )[?]
[?
]w R(Mary, x, w ) - w = y  i  For every unordered database, ph'2 true == q2 certain; but the converse does not hold: T  Dname R&D MIS  Budget 60K 60K  R  FN Mary Mary  Jef Wijsen  LN Smith Smith Data Currency  Dname R&D MIS  q2 certain ph'2 false  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Determining the Order  Attack graph For each Boolean acyclic conjunctive query q, without self-join, we compute a directed graph, called attack graph: The vertices are the atoms of q.
The directed edges, to be defined later on, are such that a first-order expression for CERTAINTY(q) can be obtained by applying our "[?][?
]-rewrite function" on any topological sort of the attack graph.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Getting the Idea  Attack graph  Join tree R(Mary, x, y )  R(Mary, x, y )  y T (y , 60K)  T (y , 60K)  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Functional Dependencies Implied by Primary Keys Definition We write vars(~x ) for the set of variables occurring in ~x .
For single atom F = R(~x , ~y ): K(F ) := vars(~x ) - vars(~x ~y ) Extension to conjunctive query q: K(q) := {K(F ) | F atom of q} Example q2 = [?]x[?
]y (R(Mary, x, y ) [?]
T (y , 60K)) K(q2 ) = {x - xy , y - y }  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Attack Graph of a Join Tree  Attack graph The attack graph of join tree t contains a directed edge from R(~x , ~y ) to another atom F if for each label L on the path that links R(~x , ~y ) and F in t : K(q \ {R(~x , ~y )}) 6|= vars(~x ) - L  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Attack Graph of a Join Tree Example Attack graph The attack graph of join tree t contains a directed edge from R(~x , ~y ) to another atom F if for each label L on the path that links R(~x , ~y ) and F in t : K(q \ {R(~x , ~y )}) 6|= vars(~x ) - L  Jef Wijsen  R0 (x, y ) {x, y }  {x} R3 (x, z) {x, z} R4 (x, z)  Data Currency  R1 (y , x) {x, y } R2 (x, y )  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Attack Graph of a Join Tree Example Attack graph The attack graph of join tree t contains a directed edge from R(~x , ~y ) to another atom F if for each label L on the path that links R(~x , ~y ) and F in t : K(q \ {R(~x , ~y )}) 6|= vars(~x ) - L  R0 (x, y ) {x, y }  {x}  R1 (y , x) {x, y } R2 (x, y )  R3 (x, z) {x, z} R4 (x, z)  K(q \ {R0 (x, y )}) [?]
{y - x, x - z} |= x - xz  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Attack Graph of a Join Tree Example Attack graph The attack graph of join tree t contains a directed edge from R(~x , ~y ) to another atom F if for each label L on the path that links R(~x , ~y ) and F in t : K(q \ {R(~x , ~y )}) 6|= vars(~x ) - L  R0 (x, y ) {x, y }  {x}  R1 (y , x) {x, y } R2 (x, y )  R3 (x, z) {x, z} R4 (x, z)  K(q \ {R1 (y , x)}) [?]
{x - y , x - z} |= y - y  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Attack Graph of a Join Tree Example Attack graph The attack graph of join tree t contains a directed edge from R(~x , ~y ) to another atom F if for each label L on the path that links R(~x , ~y ) and F in t : K(q \ {R(~x , ~y )}) 6|= vars(~x ) - L  R0 (x, y ) {x, y }  {x}  R1 (y , x) {x, y } R2 (x, y )  R3 (x, z) {x, z} R4 (x, z)  K(q \ {R3 (x, z)}) [?]
{x - y , y - x, x - z} |= x - xyz Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Main Result Acyclicity of attack graph is both sufficient and necessary for first-order expressibility.
Theorem Let q be a Boolean conjunctive query, without self join.
Let t be a join tree for q.  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Main Result Acyclicity of attack graph is both sufficient and necessary for first-order expressibility.
Theorem Let q be a Boolean conjunctive query, without self join.
Let t be a join tree for q.
Sufficient If the attack graph of t is acyclic, then CERTAINTY(q) is first-order expressible (and its first-order definition can be obtained by applying our "[?][?
]-rewrite function" on any topological sort of the attack graph).
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Main Result Acyclicity of attack graph is both sufficient and necessary for first-order expressibility.
Theorem Let q be a Boolean conjunctive query, without self join.
Let t be a join tree for q.
Sufficient If the attack graph of t is acyclic, then CERTAINTY(q) is first-order expressible (and its first-order definition can be obtained by applying our "[?][?
]-rewrite function" on any topological sort of the attack graph).
Necessary If the attack graph of t is cyclic, then CERTAINTY(q) is not first-order expressible.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Proof of Inexpressibility Result  Lemma Let q be a Boolean conjunctive query, without self join.
Let t be a join tree for q.
If the attack graph of t is cyclic, then it has a cycle of size 2.
Then we can assume two distinct atoms, say F and G , such that the attack graph contains a directed edge from F to G , and a directed edge from G to F .
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Two Databases that Locally Look the Same th1 (F )  th1 (G )  th1 (F )  th1 (G )  th2 (F )  th2 (G )  th2 (F )  th2 (G )  th3 (F )  th3 (G )  th3 (F )  th3 (G )  th4 (F )  th4 (G )  th4 (F )  th4 (G )  th5 (F )  th5 (G )  th5 (F )  u1 (G )  dbyes  u1 (G )  u2 (F )  u2 (G )  u2 (F )  u2 (G )  u3 (F )  u3 (G )  u3 (F )  u3 (G )  u4 (F )  u4 (G )  u4 (F )  u4 (G )  u5 (F )  u5 (G )  u5 (F )  dbno Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Outline  1  Data Currency Model Basic Model Extension: Currency Constraints Extension: Copying  2  More on CERTAINTY(q) Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  NonBoolean Queries NonBoolean queries Our results apply to nonBoolean queries: treat free variables as new constants.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  NonBoolean Queries NonBoolean queries Our results apply to nonBoolean queries: treat free variables as new constants.
NonBoolean query q2 (v ) = [?]x[?
]y (R(Mary, x, y ) [?]
T (y , v )) h ph2 (v ) = [?]x[?
]y R(Mary, x, y )[?]
  [?
]y R(Mary, x, y ) - T (y , v )[?]
[?
]z T (y , z) - z = v  i  For every unordered database, for every constant a, q2 (a) certain == ph2 (a) true.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Self-join Acyclic conjunctive queries with self-join q4 = [?]x[?
]y [?
]z(T (x, y ) [?]
T (y , z)) q5 = [?]x[?
]y (T (x, y ) [?]
T (y , c)) We know from earlier work [Wij09]: CERTAINTY(q4 ) is first-order expressible; CERTAINTY(q5 ) is not first-order expressible.
Attack graphs cannot distinguish q4 and q5 .
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Cyclic Queries  Cyclic conjunctive query without self-join Deciding first-order expressibility of CERTAINTY(q) for cyclic q remains open.
For example, q6 = [?]x[?
]y [?
]z(R0 (x, y ), R1 (y , z), R2 (z, x)) It is not known whether CERTAINTY(q6 ) is tractable.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Tractability of CERTAINTY(q) For q ranging over the class of Boolean acyclic conjunctive queries without self-join: we can decide whether CERTAINTY(q) is first-order expressible (and hence in AC0 ); but can we decide whether CERTAINTY(q) is in P?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Tractability of CERTAINTY(q) For q ranging over the class of Boolean acyclic conjunctive queries without self-join: we can decide whether CERTAINTY(q) is first-order expressible (and hence in AC0 ); but can we decide whether CERTAINTY(q) is in P?
Boundaries do not coincide There exists q such that CERTAINTY(q) is in P but not first-order expressible [Wij10b].
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Tractability of CERTAINTY(q) For q ranging over the class of Boolean acyclic conjunctive queries without self-join: we can decide whether CERTAINTY(q) is first-order expressible (and hence in AC0 ); but can we decide whether CERTAINTY(q) is in P?
Boundaries do not coincide There exists q such that CERTAINTY(q) is in P but not first-order expressible [Wij10b].
Dichotomy conjecture CERTAINTY(q) is in P or is coNP-complete.
For queries with exactly 2 atoms, this dichotomy has recently been proved by Kolaitis and Pena.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  The Counting Problem CERTAINTY(q) Definition For a fixed Boolean query q, the problem CERTAINTY(q) is: Given an unordered database, how many possible presents satisfy q?
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  The Counting Problem CERTAINTY(q) Definition For a fixed Boolean query q, the problem CERTAINTY(q) is: Given an unordered database, how many possible presents satisfy q?
Example R  FN Mary Mary Mary  LN Smith Smith Smith  Dname R&D MIS Toys  T  Dname R&D MIS Toys Toys  Budget 60K 60K 60K 70K  q2 = [?]x[?
]y (R(Mary, x, y ) [?]
T (y , 60K)) q2 is true in 5 possible presents (out of 6) Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  The Counting Problem CERTAINTY(q) Definition For a fixed Boolean query q, the problem CERTAINTY(q) is: Given an unordered database, how many possible presents satisfy q?
Example R  FN  LN  Dname  Mary  Smith  Toys  T  Dname R&D MIS  Budget 60K 60K  Toys  70K  q2 = [?]x[?
]y (R(Mary, x, y ) [?]
T (y , 60K)) q2 is true in 5 possible presents (out of 6) Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Complexity Dichotomy for CERTAINTY(q)  Dichotomy [MW11] For every Boolean conjunctive query q without self-join, at least one of the following holds: CERTAINTY(q) is in P; or CERTAINTY(q) is P-complete under polynomial-time Turing reductions.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Complexity Dichotomy for CERTAINTY(q)  Dichotomy [MW11] For every Boolean conjunctive query q without self-join, at least one of the following holds: CERTAINTY(q) is in P; or CERTAINTY(q) is P-complete under polynomial-time Turing reductions.
Other dichotomy A similar dichotomy holds in probabilistic databases [DRS11].
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  Summary of Main Results Uncertainty about currency leads to high data complexity.
There exist conjunctive queries q, q ' and sets S, S' of denials such that: CERTAINTY(q) is coNP-hard CONSISTENCY(S) is NP-hard CPP(q ' , S' ), certainty preservation under copying, is Sp2 -hard  But: For acyclic conjunctive queries q without self-join, we can decide whether CERTAINTY(q) is first-order definable (and hence in AC0 ).
For conjunctive queries q without self-join, we can decide whether CERTAINTY(q) is in P.  Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  References I Xin Luna Dong, Laure Berti-Equille, and Divesh Srivastava.
Truth discovery and copying detection in a dynamic world.
PVLDB, 2(1):562-573, 2009.
Nilesh N. Dalvi, Christopher Re, and Dan Suciu.
Queries and materialized views on probabilistic databases.
J. Comput.
Syst.
Sci., 77(3):473-490, 2011.
Wayne W. Eckerson.
Data quality and the bottom line: Achieving business success through a commitment to high quality data.
The Data Warehousing Institute, 2002.
Wenfei Fan, Floris Geerts, and Jef Wijsen.
Determining the currency of data.
In Maurizio Lenzerini and Thomas Schwentick, editors, PODS, pages 71-82.
ACM, 2011.
Hongfei Guo, Per-Ake Larson, and Raghu Ramakrishnan.
Caching with 'good enough' currency, consistency, and completeness.
In Klemens Bohm, Christian S. Jensen, Laura M. Haas, Martin L. Kersten, Per-Ake Larson, and Beng Chin Ooi, editors, VLDB, pages 457-468.
ACM, 2005.
Dany Maslowski and Jef Wijsen.
On counting database repairs.
In Proceedings of the 4th International Workshop on Logic in Databases, LID '11, pages 15-22, New York, NY, USA, 2011.
ACM.
Jef Wijsen  Data Currency  Data Currency Model More on CERTAINTY(q)  Deciding FO Definability of CERTAINTY(q) Technical Development Discussion and Extensions  References II  Jef Wijsen.
On the consistent rewriting of conjunctive queries under primary key constraints.
Inf.
Syst., 34(7):578-601, 2009.
Jef Wijsen.
On the first-order expressibility of computing certain answers to conjunctive queries over uncertain databases.
In Jan Paredaens and Dirk Van Gucht, editors, PODS, pages 179-190.
ACM, 2010.
Jef Wijsen.
A remark on the complexity of consistent conjunctive query answering under primary key violations.
Information Processing Letters, 110(21):950 - 955, 2010.
Jef Wijsen  Data Currency